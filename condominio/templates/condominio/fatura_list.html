{% extends 'base.html' %}

{% block title %}Faturas{% endblock %}

{% block content %}
  <div class="card">
    <div class="card-header text-center">
      <div class="text-center">
        <h6>Condomínio: <strong> {{condominio.nome}} </strong><h6>
      </div>
      <div class="col-8 m-auto pt-2 pb-2 text-center">
        <a href="{% url 'condominio:gestao' condominio.id %}" class="btn btn-outline-secondary btn-sm">Dashboard</a>
        <a href="{% url 'condominio:unidade_list' condominio.id %}" class="btn btn-outline-secondary btn-sm">Unidades</a>
        <a href="{% url 'condominio:despesa_list' condominio.id %}" class="btn btn-outline-secondary btn-sm">Despesas</a>
        <a href="{% url 'condominio:fatura_list' condominio.id %}" class="btn btn-outline-secondary btn-sm">Faturas</a>
      </div>
    </div>
    <div class="card-body">
      <div class="col-8 m-auto pb-2 text-center">
        <h5>Faturas</h5>
        <a href="{% url 'condominio:fatura_create' condominio.id%}" class="btn btn-outline-primary btn-sm"> <span class="fas fa-plus"></span> Gerar Faturas</a>
      </div>

      {% comment %} {% include 'condominio/fatura_lista_detalhe.html' %} {% endcomment %}

      <div class="col-8 m-auto pt-2 pb-2 text-center">
        <table class="table">
          <thead class="thead-dark">
            <tr>
              <th></th>
              <th scope="col">Id</th>
              <th scope="col">Unidade</th>
              <th scope="col">Proprietário</th>
              <th scope="col">Locatário</th>
              <th scope="col">Valor</th>
              <th scope="col">Competência</th>
              <th scope="col">Vencimento</th>
              {% comment %} <th scope="col">Despesas</th> {% endcomment %}
              <th scope="col">Status</th>
              <th scope="col">Ações</th>
            </tr>
          </thead>
          <tbody>
            {% for fatura in faturas %}
                <tr>
                    <td href="#collapseExample_{{ fatura.pk }}" data-bs-toggle="collapse" data-bs-placement="top" data-bs-toggle="tooltip" data-bs-placement="top" title="Visualizar Despesas"><i class="fas fa-light fa-eye"></i></td>
                    <td>{{ fatura.pk }}</td>
                    <td>{{ fatura.unidade.nome }}</td>
                    <td>{{ fatura.proprietario.nome }}</td>
                    <td>{{ fatura.locatario.nome|default:'-' }}</td>
                    <td>R$ {{ fatura.valor|floatformat:'2' }}</td>
                    <td>{{ fatura.competencia_mes }}/{{ fatura.competencia_ano|stringformat:'i' }}</td>
                    <td>{{ fatura.data_vencimento|date:'d/m/Y' }}</td>
                    {% comment %} <td ><i class="fas fa-light fa-eye"></i> {% endcomment %}

                      {% comment %} <span data-bs-toggle="tooltip" data-bs-placement="top" title=" 
                        {% for despesa in fatura.despesas_list %}
                          {{ despesa.despesa.conta.descricao }} - R$ {{ despesa.valor }}
                        {% endfor %}
                      "><i class="fas fa-light fa-eye"></i></span> {% endcomment %}

                        {% comment %} <div class="collapse" id="collapseExample_{{ fatura.pk }}">
                            <table>
                              {% for despesa in fatura.despesas_list %}
                                  <tr>
                                    <td><div>{{ despesa.despesa.conta.descricao }}</div></td>
                                    <td><div>R$ {{ despesa.valor|floatformat:'2' }}</div></td>
                                  <tr>
                              {% endfor %}
                            </table>
                        </div> {% endcomment %}

                    {% comment %} </td> {% endcomment %}
                    <td>
                        {{ fatura.status }}
                    </td>
                    <td>
                      <a href="{% url 'condominio:fatura_pagar' fatura.id %}" class="btn btn-outline-secondary btn-sm" data-bs-toggle="tooltip" data-bs-placement="top" title="Pagar"><i class="fa-solid fa-money-check-dollar"></i></a>
                    </td>
                </tr>
                <tr>
                  {% for despesa in fatura.despesas_list %}
                    <tr style="text-align: center"class="collapse" id="collapseExample_{{ fatura.pk }}">
                        <td colspan="5"><div>{{ despesa.despesa.conta.descricao }}</div></td>
                        <td colspan="5"><div>R$ {{ despesa.valor|floatformat:'2' }}</div></td>
                    </tr>
                  {% endfor %}
                </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
{% endblock %}